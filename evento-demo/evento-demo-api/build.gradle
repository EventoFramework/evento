import org.evento.cli.PublishBundle
import org.evento.cli.UpdateVersion

buildscript {
    repositories {
        mavenCentral()
        mavenLocal()
    }
    dependencies {
        classpath 'com.eventoframework:evento-cli:ev1.2.1'
    }
}


plugins {
    id 'java'
    id 'java-library'
}

group 'org.evento'
version '1.0-SNAPSHOT'

repositories {
    mavenCentral()
    mavenLocal()
}


dependencies {
    testImplementation 'org.junit.jupiter:junit-jupiter-api:5.9.0'
    testRuntimeOnly 'org.junit.jupiter:junit-jupiter-engine:5.9.0'

    api 'com.eventoframework:evento-bundle:ev1.2.1'
    api 'com.eventoframework.bus:evento-bus-rabbitmq:ev1.2.1'
    api 'io.sentry:sentry:6.23.0'
}

test {
    useJUnitPlatform()
}

tasks.register('eventoUpdateVersion') {
    dependsOn 'clean'
    doLast {
        UpdateVersion.run(file("./src").toString())
    }
}
tasks.register('eventoPublish') {
    dependsOn 'jar'
    doLast {
        PublishBundle.run(file(".").toString(), 'http://localhost:3000',
                'https://github.com/EventoFramework/evento-framework/blob/main/evento-demo/evento-demo-api')
    }
}
tasks.register('eventoUpdateVersionAndPublish') {
    dependsOn 'eventoUpdateVersion'
    finalizedBy(eventoPublish)
}
sourceCompatibility = '19'
targetCompatibility = '19'
