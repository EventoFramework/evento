import org.evento.cli.PublishBundle
import org.evento.cli.UpdateVersion

buildscript {
    repositories {
        mavenCentral()
        mavenLocal()
    }
    dependencies {
        classpath 'com.eventoframework:evento-cli:ev1.4.6'
    }
}


plugins {
    id 'java'
    id 'java-library'
}

group 'com.evento'
version '1.0-SNAPSHOT'

repositories {
    mavenCentral()
    mavenLocal()
}


dependencies {
    testImplementation 'org.junit.jupiter:junit-jupiter-api:5.9.0'
    testRuntimeOnly 'org.junit.jupiter:junit-jupiter-engine:5.9.0'


    api(project(':evento-bundle'))
    api(project(':evento-common'))
    api 'io.sentry:sentry:6.23.0'
}

test {
    useJUnitPlatform()
}

tasks.register('eventoUpdateVersion') {
    dependsOn 'clean'
    doLast {
        UpdateVersion.run(file("./src").toString())
    }
}
tasks.register('eventoPublish') {
    dependsOn 'jar'
    doLast {
        PublishBundle.run(file(".").toString(), 'http://localhost:3000',
                'https://github.com/EventoFramework/evento-framework/blob/main/evento-demo/evento-demo-api',
                'eyJraWQiOiJldmVudG8tc2VydmVyLWF1dGgta2V5IiwidHlwIjoiSldUIiwiYWxnIjoiSFMyNTYifQ.eyJjbGllbnRJZCI6ImRlcGxveUtleSIsInJvbGUiOlsiUk9MRV9QVUJMSVNIIl0sIm5iZiI6MTY5NTU3NjU4MywiaXNzIjoiZXZlbnRvLXNlcnZlciIsImV4cCI6MTcyNzExMjU4NCwiaWF0IjoxNjk1NTc2NTg0LCJqdGkiOiIxYmVjMjY0MC02YzgwLTRkZDctYjc1NC1hMDNmMTIzZjZmNTcifQ.9pY37cPqa55kAzWG8OlqPvObQ6en-f0D45HWRqzZU3E')
    }
}
tasks.register('eventoUpdateVersionAndPublish') {
    dependsOn 'eventoUpdateVersion'
    finalizedBy(eventoPublish)
}
